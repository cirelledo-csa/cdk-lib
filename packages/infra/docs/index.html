<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@ucop-acme/aws-infra</title>
	<meta name="description" content="Documentation for @ucop-acme/aws-infra">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@ucop-acme/aws-infra</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>@ucop-acme/aws-infra</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#why" id="why" style="color: inherit; text-decoration: none;">
					<h1>Why?</h1>
				</a>
				<p>These are helper libraries to unify some of the basic stack operations in AWS.
				Intended for use with codepipeline/codebuild</p>
				<a href="#install" id="install" style="color: inherit; text-decoration: none;">
					<h2>install</h2>
				</a>
				<pre><code><span class="hljs-built_in">npm</span> i @ucop-acme/aws-infra</code></pre>
				<a href="#example-usage-of-stack-tagging-cf-sample-app-directory" id="example-usage-of-stack-tagging-cf-sample-app-directory" style="color: inherit; text-decoration: none;">
					<h2>Example usage of stack tagging, cf sample app directory</h2>
				</a>
				<pre><code class="language-ts"><span class="hljs-keyword">import</span> cdk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@aws-cdk/core'</span>);
<span class="hljs-keyword">import</span> s3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/s3'</span>);
<span class="hljs-keyword">import</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@ucop-acme/aws-infra'</span>);
<span class="hljs-keyword">import</span> params <span class="hljs-keyword">from</span> <span class="hljs-string">'../test/config.json'</span>;
<span class="hljs-keyword">import</span> { Buckets } <span class="hljs-keyword">from</span> <span class="hljs-string">'./lib/buckets'</span>;

<span class="hljs-keyword">const</span> branchEnv = util.mapBranchToEnvironment().trim();

<span class="hljs-keyword">const</span> baseprops = {
  application: <span class="hljs-string">'sptn'</span>,
  buildId: <span class="hljs-string">'nope'</span>,
  createdBy: <span class="hljs-string">'alfred smithee'</span>,
  description: <span class="hljs-string">'Stop Plate Tectonics Now'</span>,
  environment: branchEnv,
  group: <span class="hljs-string">'montyPython'</span>,
  label: <span class="hljs-string">'GetMeABucket'</span>,
  owner: <span class="hljs-string">'King Khalid'</span>,
  source: <span class="hljs-string">'codecommit:us-west-2:012345678910:sptn'</span>,
};

<span class="hljs-keyword">const</span> bucketprops = {
  content: <span class="hljs-string">'magma'</span>,
  description: <span class="hljs-string">'Super Hot Data From the Earth'</span>,
  encryption: <span class="hljs-string">'KMS'</span>,
  label: <span class="hljs-string">'sample'</span>,
  log_bucket_name: <span class="hljs-string">'/dev/null'</span>,
  owner: <span class="hljs-string">'Ms Creosote'</span>,
  security_level: <span class="hljs-string">'1'</span>,
  zone: <span class="hljs-string">'core'</span>,
};

<span class="hljs-keyword">const</span> stackEnv = { account: <span class="hljs-string">'012345678910'</span>, region: <span class="hljs-string">'us-east-2'</span> };

<span class="hljs-keyword">const</span> myStackProps: util.IBaseStackProps = {
  description: <span class="hljs-string">'Stop Plate Tectonics Now'</span> + util.makeBrand(),
  env: stackEnv,
  baseprops: {
    application: <span class="hljs-string">'sptn'</span>,
    buildId: <span class="hljs-string">'https://google.com'</span>,
    createdBy: <span class="hljs-string">'alfred smithee'</span>,
    description: <span class="hljs-string">'Stop Plate Tectonics Now'</span>,
    environment: branchEnv,
    group: <span class="hljs-string">'Mr Creosote'</span>,
    label: <span class="hljs-string">'Buckets'</span>,
    owner: <span class="hljs-string">'King Khalid'</span>,
    source: <span class="hljs-string">'codecommit:us-west-2:012345678910:sptn'</span>,
  },
};

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> cdk.App();
<span class="hljs-comment">// add standard tags to all constructs in app</span>
util.tagApp(app, myStackProps);
<span class="hljs-keyword">const</span> stack = <span class="hljs-keyword">new</span> util.BaseStack(app, { description: baseprops.description + util.makeBrand(), baseprops });
<span class="hljs-keyword">const</span> myBucket = <span class="hljs-keyword">new</span> s3.Bucket(stack, { baseprops, bucketprops });
bucketprops.label = <span class="hljs-string">'other'</span>;
<span class="hljs-keyword">const</span> myOtherBucket = <span class="hljs-keyword">new</span> s3.Bucket(stack, { baseprops, bucketprops });
<span class="hljs-keyword">const</span> buckets = <span class="hljs-keyword">new</span> Buckets(app, myStackProps);</code></pre>
				<p> This will create two stacks:</p>
				<pre><code><span class="hljs-attribute">cdk ls
sptnProdBuckets
sptnProdGetMeABucket</span></code></pre><p>Notice that the generated templates contain standard tag meta:</p>
				<pre><code>cat cdk.<span class="hljs-keyword">out</span>/manifest.json | jq <span class="hljs-string">'.artifacts.sptnProdGetMeABucket.metadata["/sptnProdGetMeABucket"][].data'</span>
[<span class="hljs-meta">
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:application"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"sptn"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:buildId"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"https://google.com"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:createdBy"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"alfred smithee"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:environment"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"prod"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:group"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"Mr Creosote"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:owner"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"King Khalid"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:source"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"codecommit:us-west-2:012345678910:sptn"</span>
  },
  {
    <span class="hljs-meta-string">"Key"</span>: <span class="hljs-meta-string">"ucop:tagVersion"</span>,
    <span class="hljs-meta-string">"Value"</span>: <span class="hljs-meta-string">"0.1"</span>
  }
</span>]</code></pre>
				<a href="#tags-from-json-file" id="tags-from-json-file" style="color: inherit; text-decoration: none;">
					<h1>Tags from json file:</h1>
				</a>
				<pre><code class="language-json">{
  <span class="hljs-attr">"tags"</span>: {
    <span class="hljs-attr">"Description"</span>: <span class="hljs-string">"Stop Plate Tectonics Now"</span>,
    <span class="hljs-attr">"Owner"</span>: <span class="hljs-string">"alfred.smithee@google.com"</span>,
    <span class="hljs-attr">"Product"</span>: <span class="hljs-string">"sptn"</span>
  }
}</code></pre>
				<a href="#example-of-bucket-creation" id="example-of-bucket-creation" style="color: inherit; text-decoration: none;">
					<h1>example of bucket creation</h1>
				</a>
				<pre><code class="language-ts"><span class="hljs-keyword">import</span> infra = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@ucop-acme/aws-infra"</span>);

    <span class="hljs-comment">// product Logging bucket</span>

    <span class="hljs-keyword">const</span> LoggingBucket = <span class="hljs-keyword">new</span> infra.Bucket(<span class="hljs-keyword">this</span>, <span class="hljs-string">"log"</span>, {
      content: <span class="hljs-string">"log"</span>,
      description: <span class="hljs-string">"logging"</span>,
      env: envBranch,
      label: <span class="hljs-string">"log"</span>,
      log_bucket_name: <span class="hljs-string">""</span>,
      owner: <span class="hljs-string">"log"</span>,
      product: params[<span class="hljs-string">`tags`</span>][<span class="hljs-string">`Product`</span>],
      security_level: <span class="hljs-string">"1"</span>,
      zone: <span class="hljs-string">"log"</span>
    });</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class="label tsd-is-external">
						<span>Internals</span>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_app_app_.html">&quot;app/app&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_app_bin_vars_.html">&quot;app/bin/vars&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_app_lib_buckets_.html">&quot;app/lib/buckets&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_index_.html">&quot;lib/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_lakeformationadmingroup_.html">&quot;lib/lakeformation<wbr>Admin<wbr>Group&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_lakeformationanalystgroup_.html">&quot;lib/lakeformation<wbr>Analyst<wbr>Group&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_s3_.html">&quot;lib/s3&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_util_.html">&quot;lib/util&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_test_admin_group_test_.html">&quot;test/admin-<wbr>group.test&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_test_analyst_group_test_.html">&quot;test/analyst-<wbr>group.test&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_test_bucket_test_.html">&quot;test/bucket.test&quot;</a>
					</li>
					<li class="label tsd-is-external">
						<span>Externals</span>
					</li>
					<li class=" tsd-kind-module tsd-is-external">
						<a href="modules/_test_config_.html">&quot;test/config&quot;</a>
					</li>
					<li class=" tsd-kind-module tsd-is-external">
						<a href="modules/_test_sample_bucket_.html">&quot;test/sample-<wbr>bucket&quot;</a>
					</li>
					<li class=" tsd-kind-module tsd-is-external">
						<a href="modules/_test_sample_lakeformation_admin_group_.html">&quot;test/sample-<wbr>lakeformation-<wbr>admin-<wbr>group&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html>